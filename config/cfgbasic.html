<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Top level for configuration GUI
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script>
var browser_alert = "Asterisk Configuration GUI is currently supported in Firefox (recommended 1.5 or above) \n SeaMonkey (1.0 or above), Netscape (8.0 or above) and Opera (9.0 or above) \n\n" +	"Support for other browsers is under development \n" + 	" and will be supported in future versions";
if( navigator.userAgent.indexOf("MSIE") != -1 || navigator.userAgent.indexOf("Konqueror") != -1 || navigator.userAgent.indexOf("Safari") != -1 ){
	alert(browser_alert);
}
</script>
<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<script>
	PanelDef = Class.create();
	PanelDef.prototype = {
		initialize: function(name, label, icon, content) {
			this.name = name;
			this.label = label;
			this.icon = icon;
			this.content = content;
		}
	}
	var panels = new Array;
	var eventeater = new Object;
	var loggedon = -1;
	var started = 0;
	var accordion;
	var copyright = "Copyright &copy;2006 Digium, Inc.  All Rights Reserved. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";
	var tooltip_default = "Move the mouse over to a field to see tooltips";
	var asterisk_guitools_inextconf = 0;

	eventeater.eventcb = function(msgs) {
		if (loggedon == 1){
			astmanEngine.pollEvents();
		}
	}


	panels.push( 

		new PanelDef("home", "Home", "home.png",
			"Asterisk Configuration Panel - Please click on a panel to manage related features"),

		new PanelDef("users", "Users", "accordion-icon.gif",
			"Users is a short cut for quickly adding and removing all the necessary " +
			"configuration components for any new phone."),

		new PanelDef("meetme", "Conferencing", "accordion-icon.gif",
			"MeetMe conference bridging allow quick, ad-hoc conferences with or without " +
			"security."),

		new PanelDef("voicemail", "Voicemail", "accordion-icon.gif",
			"General settings for voicemail"),

		new PanelDef("queues", "Call Queues", "accordion-icon.gif",
			"Call queues allow calls to be sequenced to one or more agents."),

		new PanelDef("trunks", "Service Providers", "accordion-icon.gif",
			"Service Providers are outbound lines used to allow the system to make calls to the " +
			"real world.  Trunks can be VoIP lines or traditional telephony lines."),

		new PanelDef("numberplan", "Calling Rules", "accordion-icon.gif",
			"The Calling Rules define dialing permissions and least cost routing rules."),

		new PanelDef("incoming", "Incoming Calls", "accordion-icon.gif",
			"Define how your incoming calls should be handled & configure DID (Direct inward Dialing)"),

//		new PanelDef("musiconhold", "Music On Hold", "accordion-icon.gif",
//			"Music on hold sometimes keeps people less angry while they wait for an answer."),

		new PanelDef("menus", "Voice Menus", "accordion-icon.gif",
			"Menus allow for more efficient routing of calls from incoming callers."),

		new PanelDef("record", "Record a Menu", "accordion-icon.gif",
			"Allows you to record custom voicemenus over a phone"),
		
		new PanelDef("status", "Active Channels", "accordion-icon.gif", "Monitor active channels."),

		new PanelDef("sysinfo", "System Info", "accordion-icon.gif", "System Information."),

		new PanelDef("backup", "Backup", "accordion-icon.gif", "Backup Management."),

		new PanelDef("localexts", "Options", "accordion-icon.gif", "Admin Settings")

	);

	function setLoggedOn(onoff) {
		loggedon = onoff;
		if (loggedon == 1) {
			for (var i = 0; i < panels.length; i++) {
				if (panels[i].name == 'home'){
					continue;
				}
				$(panels[i].name).onclick = $(panels[i].name).realonclick;
				$(panels[i].name).onmouseover = $(panels[i].name).realonmouseover;
				$(panels[i].name).style.visibility = 'inherit';
			}
		} else {
			for (var i = 0; i < panels.length; i++) {
				if (panels[i].name == 'home'){
					// class :: accordionTabContentBox panelHeight = 474;
					continue;
				}
				$(panels[i].name).onClick = false;
				$(panels[i].name).onMouseOver = false;
				$(panels[i].name).style.visibility = 'hidden';

			}
		}
	}
	
	function loadscreen(srcbody) {
		$('mainscreen').style.display = '';
		new Rico.Effect.FadeTo($('mainscreen'), 1, 100, 1);
		if (loggedon == 1)
			astmanEngine.pollEvents();
	}
	function finishfade(page) {	$('mainscreen').style.display = "none"; 	}
	function setstatus(status) {	$('status').innerHTML = copyright + status;	}
	function showmainscreen(page) {
		if (started) 
			$('mainscreen').src = page.titleBar.id + ".html";
	}

	function fademainscreen(page, newpage) {
		// Confirm Discard Changes goes here 
		$('tooltip').innerHTML = tooltip_default;
		new Rico.Effect.FadeTo($('mainscreen'), 0, 100, 5, {complete:finishfade(page)});
	}

	function show_Acctooltip(name, tip){
		if(loggedon == 1)
		$('tooltip').innerHTML = tip;
	}


	function registerajax() {
		window.onbeforeunload = 	function(){
				if(loggedon == 1)
				return "Doing so will terminate your Asterisk GUI session"; 
		}

		window.onunload = 	function(){
				if(loggedon != 1) return true;
				var opt2 = {
						method: 'get',asynchronous: true,
						onSuccess: function() {setLoggedOn(0);loggedon == -1;},
						onFailure: function(t) {}
				};
				opt2.parameters ="action=logoff";
				var tmp2 = new Ajax.Request("../../rawman", opt2);
		}

		var pnameheight = 22;
		var pheight = (503  - (pnameheight*panels.length) ) ;
		accordion = new Rico.Accordion( $('configpanel'), { panelHeight: pheight,onHideTab:fademainscreen,onShowTab:showmainscreen });
		//$('borderbox').style.height = $('screenholder').clientHeight;
		//$('titlebar').style.width = $('borderbox').clientWidth - 12;
		for (var i = 0; i < panels.length; i++) {
			if (panels[i].name == 'home'){
				$(panels[i].name).style.height =  "19px";
				continue;
			}
			$(panels[i].name).realonclick = $(panels[i].name).onclick;
			$(panels[i].name).realonmouseover = $(panels[i].name).onmouseover;
		}
		started = 1;
	}

	astmanEngine.setURL('../../rawman');
	astmanEngine.setEventCallback(eventeater.eventcb);


	function Logoff() {
		var t=confirm("Are you sure ?");
		if(t == false)
			return true;
		var opt2 = {
			method: 'get',
			asynchronous: true,
			onSuccess: function() {	 
					setLoggedOn(0);
					loggedon == -1;
					// reload the browser URL
					window.location.href=window.location.href;
			},
			onFailure: function(t) {
				alert("Config Error: " + t.status + ": " + t.statusText);
			}
		};
		opt2.parameters ="action=logoff";
		var tmp2 = new Ajax.Request("../../rawman", opt2);
	}

	function system_link(){
		var newwindow_href = location.protocol + '//' + location.hostname + ':8003';
		window.open(newwindow_href ,'mainwindow','width=1024,height=768,resizable=no, scrollbars=no, toolbar=no, location=no,status=yes, menubar=no')
	}

</script>
<head>
	<title>Asterisk Configuration GUI (Beta)</title>
	<link rel="shortcut icon" href="images/favicon.ico" />
</head>
<body onload="javascript:registerajax()" topmargin=1>
<table border="0" align="center" cellspacing="0" cellpadding="0" bgcolor="#dddddd" width=950 height=570>
<tr height=47><td valign="bottom" align='right' bgcolor='white' height=47><img align='left' src="images/digiumlogo.gif" align="left"></td>
							<td valign='bottom' align='right' bgcolor='white' colspan=2>
									<!-- <a href="#" onclick=" system_link()">System Configuration</a>&nbsp;|&nbsp; -->
									<a target='_extern' href="http://www.digium.com/en/company/profile/">About Digium</a>&nbsp;|&nbsp;
									<a target='_extern' href="http://www.asterisknow.org/bugs">Report a Bug</a>&nbsp;|&nbsp;
									<a href="#">Help</a>&nbsp;
									<input type="hidden" id="login_name">
							</td>
</tr>
<tr><td height="505"><div id="configpanel" style="width:150px; height: 505px;">
										<script>
												for (var i = 0; i < panels.length; i++) {
													document.write("<div onmouseover='show_Acctooltip(\""+ panels[i].name +"\", \""+ panels[i].content +"\")'  onmouseout='show_Acctooltip(\""+ panels[i].name +"\", \"" + tooltip_default +"\")'>");
													document.write("	<div id='" + panels[i].name + "' class='accordionTabTitleBar'>");
													document.write("		<nobr><img style='vertical-align:middle' src='images/" + panels[i].icon + "'>");
													document.write("		<span style='margin-left: 0px;font-weight:bold'>" + panels[i].label + "</span></nobr>");
													document.write("    </div>");
													document.write("	<div class='accordionTabContentBox' style='background-image:url(images/panel.png)'>");
													document.write(panels[i].content);
													document.write("	</div>");
													document.write("</div>");
												}
										</script>
									</div>
		</td>
		<td width="550" height="505" bgcolor="#EFEFEF" valign="top" id="screenholder">
				<div id="titlebar" class="mainscreenTitleBar" style="position:absolute;top:48px">
						<span style="margin-left: 4px;font-weight:bold">Loading Screen&nbsp;<img src='images/dots.gif'></span>
				</div>
				<div id="borderbox" class="mainscreenBorderBox" height="100%"></div>
				<iframe width="540" height="505" frameborder="0" border="0" marginheight="0" marginwidth="0" src="home.html" id="mainscreen" style="position:absolute;top:48px;" SCROLLING=no></iframe>
		</td>
		<td valign=top width=250 height="505">
			<div id="logoutlink" class="mainscreenTooltipBar" align=right style="font-weight:bold;cursor: pointer; cursor: hand;">&nbsp;</div>
			<div style="margin-left: 4px;">
			<BR>
			<font style="margin-left:4px; font-family : Trebuchet MS, Arial, Helvetica, sans-serif;font-size: 11px; font-weight: bold">Tooltips:</font>
			<div id='tooltip' style="margin-left:4px; font-family : Trebuchet MS, Arial, Helvetica, sans-serif;font-size: 11px; "><script>document.write(tooltip_default);</script></div>
			</div>
		</td>
</tr>
<tr><td colspan="3" align=center height=18>
		<div id="status" class="statusbar">Copyright &copy;2006-2007 Digium, Inc.  Digium&reg; and Asterisk&reg; are registered <a href="http://www.digium.com/en/company/profile/trademarkpolicy.php">trademarks</a> of Digium, Inc.  All Rights Reserved. <i><a href="#">Legal Information</a></i></div>
		</td>
</tr>
</table>
</body>
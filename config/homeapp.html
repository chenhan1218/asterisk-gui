<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Initial login screen
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->

<script src="scripts/prototype.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />

<script>
	var demo = new Object;
	var localloggedon = -1;
	function updateButtons()
	{
		if (parent.loggedon) {
			$('username').disabled = 1;
			$('secret').disabled = 1;
			$('logoff').disabled = 0;
			$('reboot').disabled = 0;
			$('factorydefault').disabled = 0;
			$('saveconfig').disabled = 0;
			$('login').disabled = 1;
		} else {
			$('username').disabled = 0;
			$('secret').disabled = 0;
			$('logoff').disabled = 1;
			$('reboot').disabled = 1;
			$('factorydefault').disabled = 1;
			$('saveconfig').disabled = 1;
			$('login').disabled = 0;
			$('username').focus();
		}
	}
	
	function loggedOn() {
		if ((parent.loggedon == 1) && (localloggedon == 1))
			return;
		parent.setLoggedOn(1);
		parent.loggedon = 1;
		localloggedon = 1;
		updateButtons();
		$('statusbar').innerHTML = "<img src='images/tick.gif'><i>Connected!</i>";
		parent.document.getElementById('logoutlink').innerHTML = "Logout";
		parent.document.getElementById('logoutlink').onclick = parent.Logoff ;
		parent.astmanEngine.pollEvents();
	}
	
	function loggedOff() {
		if ((parent.loggedon == 0) && (localloggedon == 0))
			return;
		parent.setLoggedOn(0);
		parent.document.getElementById('logoutlink').innerHTML = "&nbsp;";
		localloggedon = 0;
		updateButtons();
	}
	
	function doSaveConfig() {
		parent.astmanEngine.run_tool("/bin/save_config");
		alert("Configuration Saved");
	}
	
	function doReboot() {
		if (confirm("Are you sure you want to reboot the appliance?")) {
			parent.astmanEngine.run_tool("/bin/reboot");
			alert("Rebooting!");
		}
	}
	
	function doFactoryDefault() {
		if (confirm("Are you sure you want to reset to factory defaults?")) {
			parent.astmanEngine.run_tool("/bin/reset_config");
			alert("Resetting to defaults.  Please reboot!");
		}
	}
	
	demo.logoffs = function(msgs) {
		$('statusbar').innerHTML = msgs[0].headers['message'];
		loggedOff();
	};

	demo.logins = function(msgs) {
		$('statusbar').innerHTML = msgs[0].headers['message'];
		resp = msgs[0].headers['response'];
		if (resp == "Success")
			loggedOn();
		else
			loggedOff();
	};
	
	demo.pongs  = function(msgs) {
		resp = msgs[0].headers['response'];
		if (resp == "Pong") {
			$('statusbar').innerHTML = "<i>Already connected...</i>";
			loggedOn();
		} else {
			$('statusbar').innerHTML = "<i>Please login...</i>";
			loggedOff();
		}
	}

	function localajaxinit() {
		parent.loadscreen(this);
	}

	function doLogin() {
		if( $('username').value == "" ){
				alert("Please enter a Username");
				$('username').focus();
				return true;			
		}

		if( $('secret').value == "" ){
				alert("Please enter a Secret");
				$('secret').focus();
				return true;			
		}
		parent.document.getElementById('login_name').value = $('username').value ;

		$('statusbar').innerHTML = "<i>Logging in...</i>";
		parent.astmanEngine.sendRequest('action=login&username=' + $('username').value + "&secret=" + $('secret').value, demo.logins);
	}
	
	function doLogoff() {
		$('statusbar').innerHTML = "<i>Logging off...</i>";
		parent.astmanEngine.sendRequest('action=logoff', demo.logoffs);
	}
	function localajaminit() {	
		parent.astmanEngine.sendRequest('action=ping', demo.pongs);
	}
	function localinit() {
		localajaxinit();
		localajaminit();
	}

	function submitOnEnter(e){ 
			if(e.keyCode == 13){ 
				doLogin();
				return false;
			}
	}
</script>
<body id="foo" onload="localinit()"  bgcolor="EFEFEF">
<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold">Welcome to the Asterisk Configuration Panel</span>
</div>
<div class="mainscreenContentBox" id="mailboxcontent">
<table class="mainscreenTable" width="100%">
	<tr valign="top">
		<td colspan=2>
			<table align="center">
				<tr><td colspan="2"><h2>Asterisk&trade; Configuration Engine</h2></td>
				<tr><td>Username:</td><td><input disabled=1 id="username" class="input9" size=12></td></tr>
				<tr><td>Password:</td><td><input disabled=1 type="password" id="secret" class="input9" size=12  onKeyPress="submitOnEnter(event)"></td></tr>
				<tr><td colspan=2 align="center">
				  <div id="statusbar">
					<span style="margin-left: 4px;font-weight:bold">&nbsp;</span>
				  </div>
				</td></tr>

				<tr><td align='center' colspan='2'><input type="submit" id="login" value="Login" disabled=1 onClick="doLogin()">
				&nbsp;&nbsp;&nbsp;&nbsp;
				<input type="submit" id="logoff" value="Logoff" disabled=1 onClick="doLogoff()"></td></tr>
				<tr><td align='center' colspan='2'><input type="submit" id="saveconfig" value="Save Config" disabled=1 onClick="doSaveConfig()">
				&nbsp;&nbsp;&nbsp;&nbsp;
				<input type="submit" id="reboot" value="Reboot" disabled=1 onClick="doReboot()">
				&nbsp;&nbsp;&nbsp;&nbsp;
				<input type="submit" id="factorydefault" value="Factory Defaults" disabled=1 onClick="doFactoryDefault()"></td></tr>
			</table>
		</td>
	</tr>
</table>
</div>
</body>

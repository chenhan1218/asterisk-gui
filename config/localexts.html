<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Configuration for "Users" generally
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<script src="scripts/tooltip.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<script>
var usercallbacks = new Object;
var fieldnames = new Array('status', 'save','userbase','localextenlength','allow_aliasextns','vmsecret','hasvoicemail','hasdirectory','hassip','hasiax','hasmanager','callwaiting','threewaycalling','hasagent','cancel','allow_an_extns');
var widgets = new Array;
var focus_fields = new Array('localextenlength','userbase','vmsecret');

function tosetup(){
	parent.window.location.href = "./setup/install.html";
}

usercallbacks.format =  function(t) {
	if(t.name == "general" ){
			return t.name;
	}
	return null;
}

usercallbacks.savechanges = function(){
	//
}

usercallbacks.beforeSaving= function(){
		if(	$('localextenlength').value != $('userbase').value.length ){
			alert("'length of Local Extensions' does not match \n the 'length of the Starting point of Allocation'");
			return false;
		}

	return true;
}


usercallbacks.loaded = function(){
		$('devices').selectitem(0);
		
		if ( typeof $('devices').stored_config.catbyname['general'].fieldbyname['localextenlength'] == "undefined" ){ 
				var opt = {
						method: 'get',
						asynchronous: true,
						onSuccess: function(t) { 
									$('localextenlength').selectedIndex = 2 ;
										parent.loadscreen(this);
						},
						onFailure: function(t) {
							alert("Config Error: " + t.status + ": " + t.statusText);
						}
					};
					opt.parameters="action=updateconfig&reload=yes&srcfilename=" + encodeURIComponent("users.conf") + "&dstfilename=" + encodeURIComponent("users.conf") + "&Action-000000=update&Cat-000000=general&Var-000000=localextenlength&Value-000000=4"; ;
					var tmp = new Ajax.Request("../../rawman", opt);
					return;
		}
		parent.loadscreen(this);
}



function localajaxinit(){
			setWindowTitle("Local Extension Settings");
			for (var x =0 ; x < fieldnames.length ; x++ ) {
				widgets[fieldnames[x]] = $(fieldnames[x]);
				widgets[fieldnames[x]].disabled = true;
			}
			for (var x =0; x < focus_fields.length; x++ ) {
				widgets[focus_fields[x]].onfocus = function(){this.className = 'input9_hilight';}
				widgets[focus_fields[x]].onblur = function(){this.className = 'input9';}
			}

			if ($('localextenlength').addEventListener){
				  $('localextenlength').addEventListener('change', update_spae, false); 
			} else if ($('localextenlength').attachEvent){
				  $('localextenlength').attachEvent('onchange', update_spae);
			}

			parent.astmanEngine.config2list("users.conf", $('devices'),widgets, usercallbacks);
}


function update_spae(){
		if(	$('localextenlength').value == $('userbase').value.length ) return;
		if(	$('localextenlength').value < $('userbase').value.length ){
				$('userbase').value = $('userbase').value.substr(0,$('localextenlength').value);
				return;
		}
		if(	$('localextenlength').value > $('userbase').value.length ){
				while ( $('localextenlength').value != $('userbase').value.length  ){
					$('userbase').value = $('userbase').value + "0" ; 
				}
		}
}

</script>
<body id="foo" onload="localajaxinit()" bgcolor="EFEFEF">
<div class="mainscreenTitleBar"><span style="margin-left: 4px;font-weight:bold">Admin Options - Local Extension Settings</span></div>
<div class="mainscreenContentBox" id="userscontent">
<TABLE align=center width="520" cellpadding=0 cellspacing=0 style="margin: 5px 0 0 0;">
<TR>
	<TD valign="bottom" align="center" class="tab"><a href="#" class="tabselected">Local Extension settings</a></TD>
	<TD><a href="options.html" class="tab">Change Password</a></TD>
	<TD valign="bottom" align="left"><a href="#" class="tab" onclick="tosetup();">Run Setup Wizard</a></TD> 
</TR>
</TABLE>
<BR>
<table class="mainscreenTable" align="center">
	<tr>	<td align="center" valign="top">
					<select id="devices" style="display:none"></select> 
	<fieldset  style="width: 400px">
		<legend>&nbsp;Local Extension Settings:&nbsp;</legend>
		<table align='center'  width='390'  cellpadding=2 cellspacing=1>
				<tr ><td class="field_text" align=left>
							Local Extensions are 
							<select id="localextenlength" class="input9">
								<option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option>
							</select> digits long&nbsp;</td>
				</tr>
				<tr ><td class="field_text" align=left>Starting point of Allocation of extensions : <input type=text id="userbase" size=5  class="input9"></td></tr>
				<tr ><td class="field_text" align="left"><input type=checkbox id="allow_aliasextns">Allow analog phones to be assigned to multiple extensions</td></tr>
				<tr ><td class="field_text" align="left"><input type=checkbox id="allow_an_extns">Allow extensions to be AlphaNumeric (SIP/IAX users)</td></tr>
			</table>
	</fieldset><BR>
	<fieldset style="width: 400px">
		<legend>&nbsp;Default Settings for a New User:&nbsp;</legend>
				<table align='center'  width='390'  cellpadding=2 cellspacing=1>

				<tr>			<td onmouseover="show_tooltip('en', 'users', 15);" class="field_text" align="right"><input type='checkbox' id='hasagent'></td>
								<td onmouseover="show_tooltip('en', 'users', 15);" class="field_text" >Is Agent</td>
								<td onmouseover="show_tooltip('en', 'users', 8);" align=right><input type='checkbox' id='hasvoicemail'></td>
								<td onmouseover="show_tooltip('en', 'users', 8);" class="field_text" align="left">Voicemail</td>
				</tr>
				
				
				<tr>			<td onmouseover="show_tooltip('en', 'users', 9);" class="field_text" align="right"><input type='checkbox' id='hasdirectory'></td>
								<td onmouseover="show_tooltip('en', 'users', 9);" class="field_text" >In Directory</td>
								<td onmouseover="show_tooltip('en', 'users', 12);" align=right><input type='checkbox' id='hasmanager'></td>
								<td onmouseover="show_tooltip('en', 'users', 12);" class="field_text" align="left">CTI</td>
				</tr>

				<tr>			<td onmouseover="show_tooltip('en', 'users', 10);" class="field_text" align="right"><input type='checkbox' id='hassip'></td>
								<td onmouseover="show_tooltip('en', 'users', 10);"  class="field_text" >SIP</td>
								<td onmouseover="show_tooltip('en', 'users', 11);" align=right><input type='checkbox' id='hasiax'></td>
								<td onmouseover="show_tooltip('en', 'users', 11);" class="field_text" align="left">IAX</td>
				</tr>

				<tr>			<td onmouseover="show_tooltip('en', 'users', 13);" class="field_text" align="right"><input type='checkbox' id='callwaiting'></td>
								<td onmouseover="show_tooltip('en', 'users', 13);" class="field_text" >Call Waiting</td>
								<td onmouseover="show_tooltip('en', 'users', 14);" align=right><input type='checkbox' id='threewaycalling'></td>
								<td onmouseover="show_tooltip('en', 'users', 14);" class="field_text" align="left">3-Way&nbsp;Calling</td>
				</tr>

				<tr>			
								<td onmouseover="show_tooltip('en', 'users', 16);" align=right><input size='3' id='vmsecret' pattern='^[0-9*]*$'  class="input9">&nbsp;</td>
								<td onmouseover="show_tooltip('en', 'users', 16);" class="field_text" align="left">VoiceMail Password</td>
								<td align=right></td>
								<td  class="field_text" align="left"></td>
				</tr>
				</table>
	</fieldset>
					<center>
							<div style="height:15px" id='status'></div><BR>
							<input type=button id="save" value="Save">
							&nbsp;&nbsp;<input type=button id="cancel" value="Cancel">
					</center>
			</td>
	</tr>
	<tr valign="top" height="18">	<td></td></tr>
</table>
</div>
</body>

<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Configuration for "Users" generally
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->

<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />

<script>
	var widgets = new Array;
	var adstatus;
	var menuscallbacks = new Object;
	var fieldnames = new Array('delete', 'status', 'new','save','cancel');
	var voicemenusdata = new Object;
	var current_context;
	var keys = new Array('zero','one','two','three','four','five','six','seven','eight','nine','star','pound');
	var extensions_array = new Array('1001','1002','6010','6275','6233','6786','7002');
	var menus_array = new Array('Support','Sales','Some');

function load_extensions(my_field_options){
		$(my_field_options).options.length=0;
		
		for(x=0; x< extensions_array.length; x++){
				var newoption = document.createElement("option"); 
				newoption.text = extensions_array[x] ; 
				newoption.value = extensions_array[x] ;
				$(my_field_options).options.add(newoption);
		}

}


function load_menus(my_field_options){
		$(my_field_options).options.length=0;
		
		for(x=0; x< menus_array.length; x++){
				var newoption = document.createElement("option"); 
				newoption.text = menus_array[x] ; 
				newoption.value = menus_array[x] ;
				$(my_field_options).options.add(newoption);
		}
}


function  key_action(a, my_field_text, my_field_options){
	if(a=='gotomenu'){
		//show menus dropdown
		$(my_field_text).style.display = "none";
		$(my_field_options).style.display = "";
		// load menus
		load_menus(my_field_options);


	}

	if(a=='gotoextension'){
		//show extensions dropdown
		$(my_field_text).style.display = "none";
		$(my_field_options).style.display = "";
		// load extensions
		load_extensions(my_field_options);

	}

	if(a=='Custom'){
		//show a  text box
		$(my_field_options).style.display = "none";
		$(my_field_text).style.display = "";
		$(my_field_text).type="text";
		$(my_field_text).size=12;
		$(my_field_text).focus();
	}

	if(a=='disabled'){
		//show nothing
		$(my_field_text).style.display = "none";
		$(my_field_options).style.display = "none";
	}


}




menuscallbacks.format = function(t, x) {
		var tmp = t.name.split('general');
		var exten_fields;

		if(tmp.length>1)
				return false;
		else if ( t.name.substr(0,10) == 'voicemenu-' && x==undefined ){	 				// if is a category
				current_context = t.name;
				voicemenusdata[current_context] = new Object();
				return t.name ;
		}else if(t.name.substr(0,10) == 'voicemenu-' ) {											// if is a subcategory 
				if (t.names[x]=='comment'){
					voicemenusdata[current_context].comment =  t.fields[x];
					voicemenusdata[current_context].extensions = new Object();
					return false;
				}
				if (t.names[x]=='exten'){
					exten_fields = t.fields[x].split (',');
					
					if(!voicemenusdata[current_context].extensions[exten_fields[0]]){
						voicemenusdata[current_context].extensions[exten_fields[0]] = new Array();
					}
					voicemenusdata[current_context].extensions[exten_fields[0]][voicemenusdata[current_context].extensions[exten_fields[0]].length] = t.fields[x] ;
				}
				return false;
		}else{	
			return false;
		}
}



menuscallbacks.postselect = function() {
	// show al lthe //s, lines in the select box - 
	if($('vmenus').selectedIndex	==-1){ return true;}
	current_context = $('vmenus').value;
	var x, y;

	//$('keypressoptions').innerHTML = "";
	$('steps').options.length =0;
	$('comment').value = voicemenusdata[current_context].comment;

	for (x=0;x<voicemenusdata[current_context].extensions['s'].length ; x++ ){
		var newoption = document.createElement("option");
		newoption.text = voicemenusdata[current_context].extensions['s'][x];
		newoption.value = voicemenusdata[current_context].extensions['s'][x];
		$('steps').options.add ( newoption );
	}

	for (y=0; y<10 ; y++ ){
			if(voicemenusdata[current_context].extensions[y]){
					// 					
	
					/*
					for (x=0;x<voicemenusdata[current_context].extensions[y].length ; x++ ){
						tmp = voicemenusdata[current_context].extensions[y][x];
						$('keypressoptions').innerHTML += "<TR><TD width=50 align=center>" +y+ "</TD><TD>"+  tmp + "</TD></TR>";
					}
					*/
			}else{
					// Key_action is disabled => hide the text & options (which already are)
			}
	}



}


menuscallbacks.loaded = function(){
			for (x=0;x<$('vmenus').options.length ; x++ ){
				$('vmenus').options[x].text = "VoiceMenu - " + voicemenusdata[$('vmenus').options[x].value].comment;
			}
}



menuscallbacks.identifier = "extension";

menuscallbacks.eachline = true;

menuscallbacks.includecats = true;


function localajaxinit() {
		
		for (x =0 ; x<fieldnames.length; x++){
			widgets[fieldnames[x]] = $(fieldnames[x]);
			widgets[fieldnames[x]].disabled = true;
		}

		parent.loadscreen(this);

		parent.astmanEngine.config2list("extensions.conf", $('vmenus'), widgets, menuscallbacks);

}



function generate_fields(key){
			document.write('<select  style="font-family: Verdana, Arial, Helvetica, Sans-Serif;font-size: 11px;"   id=\'keypress_'+ key + '_action\' onchange="key_action(this.value , keypress_' + key + '_text, keypress_' + key + '_options )">\n');
			document.write('<option value="disabled">Disabled</option>\n');
			document.write('<option value="gotomenu">Goto Menu</option>\n');
			document.write('<option value="gotoextension">Goto Extension</option>\n');
			document.write('<option value="Custom">Custom</option>\n');
			document.write('</select>&nbsp;<input type="text"  style="display:none" id="keypress_' + key+ '_text">\n');
			document.write('<select  style="display:none; font-family: Verdana, Arial, Helvetica, Sans-Serif;font-size: 11px;"  id="keypress_'+ key + '_options"></select>\n');
}

</script>


<body id="foo" onload="localajaxinit()">

<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold">Voice Menus Configuration</span>
</div>
<div class="mainscreenContentBox" id="userscontent">
<table class="mainscreenTable" align="center">
	<tr valign="top">
		<td colspan='2'>
		Voice Menus:
		</td>
	</tr>
	<tr valign="top">
		<td>
			<select size="28" id="vmenus" style="width:180px">
			<option>Loading...</option>
			</select>
		</td>
		<td valign=top align="right" width=350>

						<table cellpadding=0 align="center" width="289">
						<tr><td width="60" align=right>Name:</td><td colspan=2  align=left><input id='comment'></td></tr>
						<tr><td valign=top  align=right>Steps:</td>
								<td  align=left><select id='steps' size=5></select></td>
								<td  align=center width=55 valign="middle">
										<input  style='width:45'  type="button" id="" value="Up"><BR><BR>
										<input  style='width:45' type="button" id="" value="Down">
								</td>
						</tr>
						<tr><td colspan=3 ><BR>
								<div id="keypressoptions" style="height :330px;width=390px;">
										<table cellpadding=3 cellspacing=0 width="100%">
										<TR bgcolor='#B8B8B8'>
												<TD width=35>Key</TD><TD>Action</TD>
										</TR>

										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">0</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('zero');</SCRIPT>
												</TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">1</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('one');</SCRIPT></TD>

										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">2</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('two');</SCRIPT></TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">3</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('three');</SCRIPT></TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">4</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('four');</SCRIPT></TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">5</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('five');</SCRIPT></TD>										
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">6</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('six');</SCRIPT></TD>										
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">7</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('seven');</SCRIPT></TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">8</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('eight');</SCRIPT></TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">9</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('nine');</SCRIPT></TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 11pt">*</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('star');</SCRIPT></TD>
										</TR>
										<TR bgcolor='#FFFFFF'>
												<TD width=35 align=center><font style="font-size: 10pt">#</font></TD>
												<TD><SCRIPT LANGUAGE="JavaScript">generate_fields('pound');</SCRIPT></TD>
										</TR>
										</table>
								
								</div>
								</td>
						</tr>
						<tr><td colspan=3 align="center">
						<div style="height:15px" id='status'></div>
								</td>
						</tr>
						</table>

		</td>
	</tr>				
	<tr>
		<td align='center'>
			<input style='width:80' type='button' id='new' value='New'>
			&nbsp;
			<input style='width:80' type='button' id='delete' value='Delete'>
			&nbsp;
		</td>
		<td align='right'><input type="hidden" id="save">
				<input style='width:80' type='button' id='Save_Vmenu' value='Save'>
				&nbsp;
				<input style='width:80' type='button' id='cancel' value='Cancel'>
				&nbsp;
		</td>
	</tr>
</table>
</div>
</body>

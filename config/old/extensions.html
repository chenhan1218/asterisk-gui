<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />

<script>
	var origwidth;
	var widgets = new Array;
	var adstatus;
	var callbacks = new Object;
	var phonecallbacks = new Object;
	var numcallbacks = new Object;
	var fieldnames = new Array(
				'delete', 'status', 'new', 'save', 'cancel','name','fullname','secret','email','number','zapchan','context',
				'hasvoicemail','hasdirectory','hassip','hasiax','hasmanager','callwaiting','threewaycalling');
	callbacks.format = function(t) {
		if ((t.name == 'general'))
			return null;
		if (t.fieldbyname['fullname'] && t.fieldbyname['fullname'].length) {
			if (t.fieldbyname['number'] && t.fieldbyname['number'].length) 
				return t.name + " -- " + t.fieldbyname['fullname'] + " (" + t.fieldbyname['number'] + ")";
			else
				return t.name + " -- " + t.fieldbyname['fullname'];
		} else
			return t.name;
	}
	callbacks.loaded = function() {
		$('extensions').contentEditable = 'true';
		$('extensions').disabled = 0;
	}
	callbacks.sortfunc = function(a,b) {
		return (a.name < b.name) ? -1 : 1;
	}
	callbacks.newcategory = function() {
		var tmp = null;
		var x;
		if ($('extensions').stored_config.catbyname['general'])
			tmp = objcopy($('extensions').stored_config.catbyname['general']);
		if (tmp) {
			x = tmp.fieldbyname['userbase'];
			if (x) {
				while($('extensions').stored_config.catbyname[x]) x++;
				tmp.name = x;
			}
		}
		return tmp;
	}
	callbacks.identifier = "extension";
	
	phonecallbacks.format = function(t) {
		return "Analog Port #" + t.name;
	}

	phonecallbacks.loaded = function() {
		var noneopt = document.createElement("OPTION");
		noneopt.value = "";
		noneopt.innerHTML = "None";
		$('zapchan').options.add(noneopt, 0);
		parent.astmanEngine.config2list("numberplans.conf", $('context'), new Array(), numcallbacks);
	}
	
	numcallbacks.format = function(t) {
		if ((t.name == 'general'))
			return null;
		if (t.fieldbyname['desc'])
			return t.fieldbyname['desc'];
		return t.name;
	}

	numcallbacks.loaded = function() {
		parent.astmanEngine.config2list("extensions.conf", $('extensions'), widgets, callbacks);
	}
	
	function togglefeatures() {
		if (adstatus == "shown") {
			adstatus = "hidden";
			new Rico.Effect.Size('features', 1, null, 120, 8, {complete:function() { $('features').style.width=0;} } );
		} else {
			adstatus = "shown";
			$('features').style.visibility = "visible";
			new Rico.Effect.Size('features', 140, null, 120, 8 );
		}
	}
	function localajaxinit() {
		$('features').style.overflow = "hidden";
		$('features').style.width = 0;
		$('features').style.height = $('split').height;
		adstatus = "hidden";
		$('extensions').contentEditable = 'false';
		for (var x in fieldnames) {
			widgets[fieldnames[x]] = $(fieldnames[x]);
			widgets[fieldnames[x]].disabled = true;
		}
		parent.astmanEngine.config2list("zapscan.conf", $('zapchan'), new Array(), phonecallbacks);
		parent.loadscreen(this);
	}
</script>


<body id="foo" onload="localajaxinit()">

<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold">Special Extension Configuration</span>
</div>
<div class="mainscreenContentBox" id="mailboxcontent">
<table class="mainscreenTable" align="center">
	<tr valign="top">
		<td colspan='3'>
		Users:
		</td>
	</tr>
	<tr valign="top">
		<td>
		<select disabled size="10" id="extensions" style="width:480px">
		<option>Loading...</option>
		</select>
		</td>
		<td>
			&nbsp;&nbsp;
		</td>
		<td align='center'>
			<table>
			<tr align='center'><td>
			<input style='width:80' type='button' id='new' value='New'>
			</td></tr>
			<tr align='center'><td>
			<input style='width:80' type='button' id='delete' value='Delete'>
			</td></tr>
			</table>
		</td>

	</tr><tr>
		<td colspan='3'>
		<div id='adjustments'>
		<table cellspacing='0' cellpadding='0'>
			<tr valign="top"><td>
				<table>
				<tr><td>Extension:</td><td><input size='5' id='name'></td></tr>
				<tr><td>Name:</td><td><input size='15' id='fullname'></td></tr>
				<tr><td>Password:</td><td><input size='5' id='secret'></td></tr>
				<tr><td>E-mail:</td><td><input size='20' id='email'></td></tr>
				<tr><td>Caller ID:</td><td><input size='12' id='number'></td></tr>
				<tr><td>Analog Phone:</td><td><select size="1" id='zapchan'></select></td></tr>
				<tr><td>Number Plan:</td><td><select size='1' id='context'></td></tr>
				<tr><td colspan='2' align='center'><div style="height:15px" id='status'></div></td></tr>
				</table>
			</td>
			<td rowspan='2'>
				<img id="split" onClick="togglefeatures()" src="images/split.png">
			</td>
			<td rowspan='2'>
				<div style="background-image:url(images/slice.png)" id='features'>
				<table>
				<tr><td>&nbsp;</td><td>&nbsp;</td></tr>
				<tr><td>Voicemail:</td><td><input type='checkbox' id='hasvoicemail'></td></tr>
				<tr><td>In Directory:</td><td><input type='checkbox' id='hasdirectory'></td></tr>
				<tr><td>SIP:</td><td><input type='checkbox' id='hassip'></td></tr>
				<tr><td>IAX:</td><td><input type='checkbox' id='hasiax'></td></tr>
				<tr><td>CTI:</td><td><input type='checkbox' id='hasmanager'></td></tr>
				<tr><td>Call&nbsp;Waiting:</td><td><input type='checkbox' id='callwaiting'></td></tr>
				<tr><td>3-Way&nbsp;Calling:</td><td><input type='checkbox' id='threewaycalling'></td></tr>
				</table>
				</div>
			</td>
			<td rowspan='2'>
				<img onClick="togglefeatures()" src="images/adv.png">
			</td>
			</tr>
			<tr><td colspan='1' align='right'>
				<input style='width:80' type='button' id='save' value='Save'>
				&nbsp;
				<input style='width:80' type='button' id='cancel' value='Cancel'>
				&nbsp;
			</td></tr>
		</table>
		</div>
		</td>				
	</tr>
</table>
</div>
</body>

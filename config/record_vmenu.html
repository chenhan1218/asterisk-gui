<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Configuration for "Users" generally
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->

<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />

<script>
var callbacks = new Object;

callbacks.format = function(t) {
	if ((t.name == 'general'))
		return null;
	if (t.name.substring(0,6) == 'trunk_')
		return null;
	if (t.fieldbyname['fullname'] && t.fieldbyname['fullname'].length) {
		return t.name + " -- " + t.fieldbyname['fullname'];
	} else
		return t.name;
}

function localajaxinit() {
	parent.astmanEngine.config2list("users.conf", $('devices'), new Array, callbacks);
	parent.loadscreen(this);
	$('message_text').innerHTML = " Saving Changes ... ";
}


function record_new(){
		$('status_message').style.display="block";
		var opt = {
			method: 'get',
			asynchronous: true,
			onSuccess: function(t) { 
					setTimeout("$('status_message').style.display='none'",sc_displaytime);
					if ( t.responseText.indexOf("Originate successfully queued") == -1 ){
							// Request Failed
					}else{
						$('status').innerHTML = " <I> Configuration Saved ! </I>";
						$("newvmenu_name").value="";
						$("format").selectedIndex =0;
						$("newvmenu_ext").value="";						
					}				
			},
			onFailure: function(t) {
				$('status_message').style.display='none';
				alert("Config Error: " + t.status + ": " + t.statusText);
			}
		};
		opt.parameters ="action=originate&channel=Local/"+$('newvmenu_ext').value+ "&context=record_vmenu&exten=1&priority=1&Variable=var1%3d"+ encodeURIComponent($('newvmenu_name').value + "." + $('format').value);
		var tmp = new Ajax.Request("../../rawman", opt);
		return;
}
</script>
<body id="foo" onload="localajaxinit()">
<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold">Record a Custom VoiceMenu</span>
</div>
<div class="mainscreenContentBox" id="userscontent">
<table class="mainscreenTable" align="center">
	<tr><td valign="top" align="center">
			<BR>
			<table cellpadding=3 cellspacing=0 border=0 width=400>
				<tr><td colspan=3 align=center><B>List of recorded voicemenus</B></td></tr>
				<tr bgcolor="#FFFFFF"><td><font color="#2D4E93">File Name</font></td>
						<td><font color="#2D4E93">Size</font></td>
						<td></td>
				</tr>
				<tr><td>Some_Filename1.gsm</td>
						<td>230kb</td>
						<td align=center><input type=checkbox id='select_filename1'></td>
				</tr>
				<tr><td></td>
						<td></td>
						<td><input type=button id='delete' value="delete"></td>
				</tr>
			</table>



			<BR><BR>
			<table cellpadding=2 cellspacing=2 border=0>
				<tr>	<td colspan=2 height=40 valign=middle align=center><B>Record a new voicemenu</B> </td>	</tr>
				<tr><td>File Name:</td>
						<td><input id='newvmenu_name' size=16></td>
				</tr>
				<tr><td>Format:</td>
						<td><select id='format'>
										<option value="gsm">gsm</option>
										<option value="g723">g723</option>
										<option value="g729">g729</option>
										<option value="h623">h623</option>
										<option value="ulaw">ulaw</option>
										<option value="alaw">alaw</option>
										<option value="vox">vox</option>
										<option value="wav">wav</option>
										<option value="WAV">WAV</option>
								</select>
						</td>
				</tr>
				<tr>	<td>Extension used for recording:</td>
						<td><input id='newvmenu_ext' size=16>
								<div  id="combobox_div"><select id='devices'></select></div>
								<SCRIPT LANGUAGE="JavaScript">
										combo_box('newvmenu_ext', "combobox_div","devices");
								</SCRIPT>
						</td>
				</tr>
				<tr>	<td colspan=2 align=center height=10></td></tr>
				<tr>	<td colspan=2 align=center><input type="button" id='record' Value="Record" onclick="record_new()"></td></tr>
				<tr>	<td colspan=2 align=center height=10><div id="status"></div></td></tr>
			</table>
	</td>
	</tr>
</table>
</div>
<SCRIPT LANGUAGE="JavaScript">
<!--
showdiv_statusmessage();
//-->
</SCRIPT>
</body>

<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Initial login screen
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="scripts/prototype.js"></script>
<script>
var cats = new Array();
var asterisk_guitools = "asterisk_guitools";

	function show_installed(){
		alert("Installed");
	}

	function installguitools(){
		var opt = {
			method: 'get',
			asynchronous: true,
			onComplete: show_installed
		};
		opt.parameters="action=updateconfig&reload=yes&srcfilename=extensions.conf&dstfilename=extensions.conf&"  +

		"Action-000000=newcat&Cat-000000=" + asterisk_guitools + "&Var-000000=&Value-000000=" + "&" + 
		
		"Action-000001=append&Cat-000001=" + asterisk_guitools + "&Var-000001=exten&Value-000001=" +
		encodeURI(		'save_config,1,System(/bin/save_config)' 	) + "&" + 

		"Action-000002=append&Cat-000002=" + asterisk_guitools + "&Var-000002=exten&Value-000002=" +
		encodeURI(		'factory_default,1,System(/bin/reset_config)' 	) + "&" + 

		"Action-000003=append&Cat-000003=" + asterisk_guitools + "&Var-000003=exten&Value-000003=" +
		encodeURI(		'reboot,1,System(/bin/reboot)' 	) + "&" + 

		"Action-000004=append&Cat-000004=" + asterisk_guitools + "&Var-000004=exten&Value-000004=" +
		encodeURI(		'removefile,1,System(/bin/rm ${var1})' 	) + "&" + 

		"Action-000005=append&Cat-000005=" + asterisk_guitools + "&Var-000005=exten&Value-000005=" +
		encodeURI(		'removefile,n,Hangup()' 	) + "&" + 

		"Action-000006=append&Cat-000006=" + asterisk_guitools + "&Var-000006=exten&Value-000006=" +
		encodeURI(		'sysinfo,1,System(sh /etc/asterisk/gui_sysinfo)' 	) + "&" + 

		"Action-000007=append&Cat-000007=" + asterisk_guitools + "&Var-000007=exten&Value-000007=" +
		encodeURI(		'sysinfo,n,Hangup()' 	) + "&" + 

		"Action-000008=append&Cat-000008=" + asterisk_guitools + "&Var-000008=exten&Value-000008=" +
		encodeURI(		'takebackup,1,System(/bin/tar -cf ${var1} /etc/asterisk/)' 	) + "&" + 

		"Action-000009=append&Cat-000009=" + asterisk_guitools + "&Var-000009=exten&Value-000009=" +
		encodeURI(		'takebackup,n,Hangup()' 	) + "&" + 

		"Action-000010=append&Cat-000010=" + asterisk_guitools + "&Var-000010=exten&Value-000010=" +
		encodeURI(		'record_vmenu,1,Answer' 	) + "&" + 

		"Action-000011=append&Cat-000011=" + asterisk_guitools + "&Var-000011=exten&Value-000011=" +
		encodeURI(		'record_vmenu,n,Playback(vm-intro)' 	) + "&" + 

		"Action-000012=append&Cat-000012=" + asterisk_guitools + "&Var-000012=exten&Value-000012=" +
		encodeURI(		'record_vmenu,n,Record(${var1})' 	) + "&" + 

		"Action-000013=append&Cat-000013=" + asterisk_guitools + "&Var-000013=exten&Value-000013=" +
		encodeURI(		'record_vmenu,n,Playback(vm-saved)' 	) + "&" + 

		"Action-000014=append&Cat-000014=" + asterisk_guitools + "&Var-000014=exten&Value-000014=" +
		encodeURI(		'record_vmenu,n,Playback(vm-goodbye)' 	) + "&" + 

		"Action-000015=append&Cat-000015=" + asterisk_guitools + "&Var-000015=exten&Value-000015=" +
		encodeURI(		'record_vmenu,n,Hangup' 	) + "&" + 

		"Action-000016=append&Cat-000016=" + asterisk_guitools + "&Var-000016=exten&Value-000016=" +
		encodeURI(		'play_file,1,Answer' 	) + "&" + 

		"Action-000017=append&Cat-000017=" + asterisk_guitools + "&Var-000017=exten&Value-000017=" +
		encodeURI(		'play_file,n,Playback(${var1})' 	) + "&" + 

		"Action-000018=append&Cat-000018=" + asterisk_guitools + "&Var-000018=exten&Value-000018=" +
		encodeURI(		'play_file,n,Hangup'  )  ;

		var tmp = new Ajax.Request("../../rawman", opt);

	/*
	exten => 
*/
		
	}

	function getextconf(){
		var opt = {
			method: 'get',
			asynchronous: true,
			onComplete: showExtconfig
		};
		opt.parameters="action=getconfig&filename=extensions.conf" ;
		var tmp = new Ajax.Request("../../rawman", opt);
	}

	function showExtconfig(originalRequest){
		// now parse the output and search for [gui-tools]
		var lines = originalRequest.responseText.split("\n");
		for( var i=0 ; i < lines.length ; i++){
				if ( lines[i].substr(0,9) == "Category-"  ){
					var tmp = lines[i].split(": ");
					if( tmp[1].match(asterisk_guitools) ){
						alert("Already Installed");
						return false;
					}
					cats.push(tmp[1]);
				}
		}
		
		// Install the [asterisk_guitools] section in extensions.conf
		installguitools();
	}
	

	function doLogin(){
			var opt = {
				method: 'get',
				asynchronous: true,
				onComplete: showResponse
			};
			opt.parameters="action=login&reload=yes&username="+ $('username').value + "&secret=" + $('secret').value ;
			var tmp = new Ajax.Request("../../rawman", opt);
	}

	function showResponse(originalRequest){
		if ( originalRequest.responseText.match("Success") ) {
			getextconf();
			// user authenticated .. check if [tools] is installed in extensions.conf ( we probably need astman.js to do this)
			// if not then install the [tools]
		}
	}



	function install(){
			var opt = {
				method: 'get',
				asynchronous: true,
				onComplete: doLogin
			};
			opt.parameters="action=logoff" ;
			var tmp = new Ajax.Request("../../rawman", opt);
	}


	function localinit() {

	}

</script>
<body id="foo" onload="localinit()" topmargin=0  bgcolor="FFFFFF">
<BR>
<h2>Asterisk&trade; Configuration Engine</h2>
<BR><BR>
<center>
	<span style="margin-left: 4px;font-weight:bold"> This would install a 'asterisk_guitools' context in your extensions.conf </span><BR>
	Please enter your username and password defined in manager.conf
<center>
<BR>
<table align="center">
	<tr><td>Username:</td>
			<td><input id="username"  size=12></td>
	</tr>
	<tr><td>Secret:</td>
			<td><input type="password" id="secret" size=12></td>
	</tr>
	<tr><td align='center' colspan='2'>
				<input type="button" id="login" value="Install" onClick="install()" >
			</td>
	</tr>
</table>
</body>

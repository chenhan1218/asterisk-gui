<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Configuration for "Users" generally
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->
<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<script src="scripts/tooltip.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />
<script>
var sysinfocallbacks = new Object;
var tabs = new Array('tab1', 'tab2', 'tab3','tab4');
var divs_tohide = new Array('osversion_div', 'uptime_div', 'asterisk_div', 'today_div','hostname_div','ifconfig_div','df_div','memory_div','today_log');

function thisday_log(){
	$('status_message').style.display="block";
	if($('log_day').value < 10 ){
		var tmp_command = "/bin/grep /var/log/asterisk/messages -e '" + $('log_month').value + "  " + $('log_day').value + " ' > /var/lib/asterisk/static-http/config/bkps/today_log.html";
	}else{
		var tmp_command = "/bin/grep /var/log/asterisk/messages -e '" + $('log_month').value + " " + $('log_day').value + " ' > /var/lib/asterisk/static-http/config/bkps/today_log.html";
	}
	parent.astmanEngine.run_tool( tmp_command , onSuccess = function() { 
					$('status_message').style.display='none';
					load_todayslog();
				}
	);

}

function 	load_todayslog(){
		$('status_message').style.display='block';
		var opt = {
			method: 'get',
			asynchronous: true,
			onComplete: function(originalRequest){
				$('status_message').style.display='none';
				if(originalRequest.responseText.length==0){
					$('todaylog').innerHTML = "No log messages found on this Day" ;
				}else{
					$('todaylog').innerHTML = "<PRE>"+originalRequest.responseText.escapeHTML() +"</PRE>";
				}
			},
			onFailure: function(t) {
				$('status_message').style.display='none';
				alert("Config Error: " + t.status + ": " + t.statusText);
			}
		};
		opt.parameters="";
		var tmp = new Ajax.Request("./bkps/today_log.html", opt);
		return true;
}

function show_window(x){
		for(i=0; i < tabs.length ; i++){
			document.getElementById(tabs[i]).className = "tab";
		}
		document.getElementById(tabs[x-1]).className = "tabselected";
		document.getElementById(tabs[x-1]).blur();
		

		switch(x){
			case 1:
			var divs_toshow = new Array('osversion_div', 'uptime_div', 'asterisk_div', 'today_div','hostname_div');
			break;
			case 2:
			var divs_toshow = new Array('ifconfig_div');
			break;
			case 3:
			var divs_toshow = new Array('df_div','memory_div');
			break;
			case 4:
			var divs_toshow = new Array('today_log');
			break;
		}
		
		for(var i=0; i < divs_tohide.length; i++ )
				$(divs_tohide[i]).style.display = "none";
		for(var i=0; i < divs_toshow.length; i++ ){
			$(divs_toshow[i]).style.display = "";
			//$(divs_toshow[i]).focus();
		}
		return false;
}

function update_sysinfo(){
	parent.astmanEngine.run_tool("sh /etc/asterisk/gui_sysinfo", onSuccess = function() { 
					$('status_message').style.display='none';
					getsysinfohtml();
				}
	);
	return;
}


function getsysinfohtml(){
		var opt = {
			method: 'get',
			asynchronous: true,
			onComplete: function(originalRequest){
				$('sysinfohtml').innerHTML = originalRequest.responseText;
				$('osversion').innerHTML = $('si_uname').innerHTML;
				$('uptime').innerHTML = $('si_uptime').innerHTML;
				$('asterisk').innerHTML =$('si_astver').innerHTML + "<BR>" + "Asterisk GUI-version " + asterisk_guiversion.substr(1) ;
				$('today').innerHTML = $('si_date').innerHTML;
				$('hostname').innerHTML =$('si_hostname').innerHTML;
				$('ifconfig').innerHTML =$('si_ifconfig').innerHTML;
				$('diskusage').innerHTML = $('si_du').innerHTML;
				$('memoryusage').innerHTML =$('si_free').innerHTML;

				var divs_toshow = new Array('osversion_div', 'uptime_div', 'asterisk_div', 'today_div','hostname_div');
				for(var i=0; i < divs_toshow.length; i++ ){
					$(divs_toshow[i]).style.display = "block";
				}

				document.getElementById(tabs[0]).className = "tabselected";

				load_todayslog();

			},
			onFailure: function(t) {
				$('status_message').style.display='none';
				alert("Config Error: " + t.status + ": " + t.statusText);
			}
		};
		opt.parameters="";
		var tmp = new Ajax.Request("./bkps/sysinfo_output.html", opt);
		return true;
}


function localajaxinit(){
	setWindowTitle("System Info");
	// call the tool (sysinfo)
	var date = new Date() ; 
	showdiv_statusmessage();
	$('log_month').selectedIndex = date.getMonth() ;
	$('log_day').selectedIndex = date.getDate()  - 1 ;
	$('status_message').style.display="block";
	$('message_text').innerHTML = "Loading system Information ...";
	parent.loadscreen(this);
	update_sysinfo();
}

function free_mem(){
	if( navigator.userAgent.indexOf("MSIE") == -1 ){ return true; }
	try{
		purge( document.body );
	} catch(e){ }
}

</script>
<body id="foo" onload="localajaxinit()" bgcolor="EFEFEF"  onunload="free_mem()">
<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold;">System Information</span>
	<span style="cursor: pointer; cursor: hand;" onclick="window.location.href=window.location.href;" >&nbsp;<img src="images/refresh.png" title=" Refresh " border=0 >&nbsp;</span>
</div>
<div class="mainscreenContentBox" id="userscontent">
<table class="mainscreenTable" align="center">
	<tr valign="top" height="18">	
			<td align="left">

				<a href="#" class="tab" onclick="return show_window(1);" id="tab1">General</a>&nbsp;&nbsp;
				<a href="#" class="tab" onclick="return show_window(2);" id="tab2">ifconfig</a>&nbsp;&nbsp;
				<a href="#" class="tab" onclick="return show_window(3);" id="tab3">Resources</a>&nbsp;&nbsp;
				<a href="#" class="tab" onclick="return show_window(4);" id="tab4">Logs</a>&nbsp;&nbsp;
				<div id="sysinfohtml" style="display:none"></div>

				<div id="information" style=" border: solid 0px black; background: transparent; padding: 4px; height:440px; width:95%;">
						<BR>
						<div id="osversion_div" style="display:none">
								OS Version: <div id="osversion" style="font-family:courier; font-size:10pt;"></div><BR>
						</div>
						<div id="uptime_div" style="display:none">
								Uptime: <div id="uptime" style="font-family:courier; font-size:10pt;"></div><BR>
						</div>
						<div id="asterisk_div" style="display:none">
								Asterisk Build: <div id="asterisk" style="font-family:courier; font-size:10pt;"></div><BR>
						</div>
						<div id="today_div" style="display:none">
								Server Date & TimeZone: <div id="today" style="font-family:courier; font-size:10pt;"></div><BR>
						</div>
						<div id="hostname_div" style="display:none">
								Hostname: <div id="hostname" style="font-family:courier; font-size:10pt;"></div><BR>
						</div>
						<div id="ifconfig_div" style="display:none; height:430px; ">
								ifconfig:<PRE><div id="ifconfig" style="font-family:courier; font-size:8.5pt; height:410px; overflow :auto;"></div></PRE>
						</div>
						<div id="df_div" style="display:none;">
								Disk Usage:<PRE><div id="diskusage" style="font-family:courier; font-size:10pt;"></div></PRE>
						</div>
						<div id="memory_div" style="display:none;">
								Memory Usage:<PRE><div id="memoryusage" style="font-family:courier; font-size:8.5pt;"></div></PRE>
						</div>
						<div id="today_log" style="display:none;">
								Asterisk Log messages (today): <select id="log_month"><option value="Jan">Jan</option><option value="Feb">Feb</option> <option value="Mar">Mar</option><option value="Apr">Apr</option>
										<option value="May">May</option><option value="Jun">Jun</option><option value="Jul">Jul</option><option value="Aug">Aug</option><option value="Sep">Sep</option>
										<option value="Oct">Oct</option><option value="Nov">Nov</option><option value="Dec">Dec</option></select>
								<select id="log_day"><SCRIPT LANGUAGE="JavaScript">
											for(var i=1; i < 32; i++){ document.write( '<option value="' + i + '">' + i + '</option>' ); }</SCRIPT></select><input type="button" value="Go" onclick="thisday_log();">
								<div id="todaylog" style="font-family:courier; font-size:8.5pt; width:522px; height:405px; overflow :auto;"></div>
						</div>
				</div>
			</td>
	</tr>
	<tr><td valign="top" align=center><div  id='status'></div></td></tr>
	<tr><td></td></tr>
</table>
</div>
</body>

<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Configuration for "Voicemail Extensions"
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->

<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<script src="scripts/tooltip.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />

<script>
	var origwidth;
	var vmwidgets = new Array;
	var widgets = new Array;
	var vmexten='';
	var adstatus;
	var voicemails;
	var callbacks = new Object;
	var usercallbacks = new Object;
	var voicemailcallbacks = new Object;
	var vmfields = new Array('status', 'save', 'cancel',
							  'attach','maxmsg','minmessage','maxmessage','saycid','sayduration', 'emailonly',
							  'review',
							  'attachfmt','maxgreet','operator','envelope');

	var fields = new Array('name');
	
	function changed_extension() {
		var app;
		tmp = $('extensions').value.split(']');
		app = findapp($('extensions').stored_config.catbyname[tmp[0]].subfields[tmp[1]]['app']);
		$('name').value = $('extensions').stored_config.catbyname[tmp[0]].subfields[tmp[1]]['name'];
	};
	
	function newexten() {
		var newname = $('name').value;
		$('save').disabled = false;
	}

	callbacks.format = function(t, x) {
		if ((t.name != specialcontext))
			return null;
		return format_extension($('extensions'), t, x);
	}
	
	callbacks.loaded = function() {
		var whichexten = "";
		merge_users($('extensions'), $('hiddenusers'));
		for (x=0;x<$('extensions').options.length;x++) {
			var tmp;
			tmp = $('extensions').options[x].value.split(']');
			if (tmp.length > 1) {
				if ($('extensions').stored_config.catbyname[tmp[0]].subfields[tmp[1]]['app'].toLowerCase() != "voicemailmain") {
					$('extensions').options[x].disabled = true;
				} else {
					whichexten = $('extensions').stored_config.catbyname[tmp[0]].subfields[tmp[1]]['name'];
					$('extensions').selectitem(x);
					vmexten = whichexten;
				}
			}
		}
		$('extensions').contentEditable = 'true';
		$('extensions').disabled = 0;
		$('extensions').current_category = specialcontext;
		$('name').onkeydown = newexten;
		$('name').disabled = false;
		parent.loadscreen(this);
	}
	
	callbacks.fields2val = function() {
		return $('name').value + ",1,VoiceMailMain";
	}
	
	callbacks.sortfunc = function(a,b) {
		return (a.name < b.name) ? -1 : 1;
	}
	
	callbacks.newsubitem = function() {
		var tmp = new Object;
		tmp['name'] = $('name').value;
		tmp['>'] = true;
		return new Array(specialcontext, 'exten', tmp);
	}
	
	callbacks.identifier = "extension";
	callbacks.eachline = true;
	callbacks.usesubfields = true;
	
	usercallbacks.format = function(t) {
		if ((t.name == 'general'))
			return null;
		if (t.name.substring(0,6) == 'trunk_')
			return null;
		if (t.fieldbyname['fullname'] && t.fieldbyname['fullname'].length) {
			return t.name + " -- " + t.fieldbyname['fullname'];
		} else
			return t.name;
	}
	usercallbacks.loaded = function() {
		parent.astmanEngine.config2list("extensions.conf", $('extensions'), widgets, callbacks);
	}

	function togglefeatures() {
		if (adstatus == "shown") {
			adstatus = "hidden";
			new Rico.Effect.Size('advancedw', null, 1, 120, 8, {complete:function() { $('advancedw').style.height=1;} } );
		} else {
			adstatus = "shown";
			$('advancedw').style.visibility = "visible";
			new Rico.Effect.Size('advancedw', null, 140, 120, 8 );
		}
	}
	
	
	voicemailcallbacks.savechanges = function() {
		if (vmexten != $('name').value) {
			if (vmexten.length) {
				if (!$('name').value.length) {
					delete_item($('extensions'),null,1);
				} else {
					save_item($('extensions'));
				}
			} else {
				new_subitem($('extensions'));
				save_item($('extensions'));
			}
			vmexten = $('name').value;
			$('name').disabled = false;
			return true;
		}
		$('name').disabled = false;
		return false;
	}

	voicemailcallbacks.loaded = function() {
		$('hiddenvoicemail').selectedIndex = 0;
		if ($('hiddenvoicemail').onchange)
			$('hiddenvoicemail').onchange($('hiddenvoicemail'));
		parent.astmanEngine.config2list("users.conf", $('hiddenusers'), new Array(), usercallbacks);
	}
	
	voicemailcallbacks.format = function(t) {
		if (t.name != 'general')
			return null;
		return "General";
	}
	
	function localajaxinit() {
		$('advancedw').style.overflow = "hidden";
		$('advancedw').style.height = 1;
		$('advancedw').style.width = $('split').width;
		$('advancedi').style.width = $('split').width - 60;
		adstatus = "hidden";
		$('extensions').contentEditable = 'false';
		for (var x in vmfields) {
			vmwidgets[vmfields[x]] = $(vmfields[x]);
			vmwidgets[vmfields[x]].disabled = true;
		}
		for (var x in fields) {
			widgets[fields[x]] = $(fields[x]);
			widgets[fields[x]].disabled = true;
		}
		parent.astmanEngine.config2list("voicemail.conf", $('hiddenvoicemail'), vmwidgets, voicemailcallbacks);
	}
</script>


<body id="foo" onload="localajaxinit()">

<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold">Voicemail Configuration</span>
</div>
<div class="mainscreenContentBox" id="mailboxcontent">
<table class="mainscreenTable" align="center">
	<tr valign="top">
		<td colspan='2'>
		Extensions:
		</td>
	</tr>
	<tr valign="top">
		<td>
		<select disabled size="28" id="extensions" style="width:220px">
		<option>Loading...</option>
		</select>
		</td>
		<td>
		<div id='adjustments'>
		<table cellspacing='0' cellpadding='0'>
			<tr valign="top"><td>
				<table>
				<tr onmouseover="show_tooltip('en', 'voicemail', 0);" ><td>Extension for checking messages:</td><td>&nbsp;<input size='5' id='name' pattern='^\d*$'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 1);" ><td>Attach recordings to e-mail:</td><td><input type='checkbox' id='attach'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 2);" ><td>Say message Caller-ID:</td><td><input type='checkbox' id='saycid'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 3);" ><td>Say message duration:</td><td><input type='checkbox' id='sayduration'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 4);" ><td>Send messages by e-mail only:</td><td><input type='checkbox' id='emailonly'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 5);" ><td>Maximum messages per folder:</td><td>&nbsp;<select id='maxmsg'><option value='10'>10</option><option value='25'>25</option><option value='100'>100</option><option value='250'>250</option><option value='500'>500</option><option value='1000'>1000</option></select></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 6);" ><td>Maximum message time</td><td>&nbsp;<select id='maxmessage'><option value='60'>1 minute</option><option value='120'>2 minutes</option><option value='300'>5 minutes</option><option value='900'>15 minutes</option><option value='1800'>30 minutes</option><option value='0'>Unlimited</option></select></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 7);" ><td>Minimum message time:</td><td>&nbsp;<select id='minmessage'><option value='0'>No minimum</option><option value='1'>1 second</option><option value='2'>2 seconds</option><option value='3'>3 seconds</option><option value='4'>4 seconds</option><option value='5'>5 seconds</option></select></td></tr>

				<tr><td colspan='2' align='center'><div style="height:15px" id='status'></div></td></tr>
				</table>
			</td>
			</tr>
			<tr onmouseover="show_tooltip('en', 'voicemail', 8);" ><td><img id="split" onClick="togglefeatures()" src="images/split-v.png"></td></tr>
			<tr><td>
				<div style="background-image:url(images/slice-v.png)" id='advancedw'>
				<table id='advancedi' align='center'>
				<tr><td></td><td width='50'></td><td></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 9);" ><td colspan='2'>Dial&nbsp;'0'&nbsp;for&nbsp;Operator:</td><td align='right'><input type='checkbox' id='operator'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 10);" ><td>Message&nbsp;Format:</td><td colspan='2' align='right'><select id='attachfmt'><option value='wav49'>WAV (GSM)</option><option value='wav'>WAV (16-bit)</option><option value='gsm'>Raw GSM</option></select></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 11);" ><td colspan='2'>Allow&nbsp;users&nbsp;to&nbsp;review:</td><td align='right'><input type='checkbox' id='review'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 12);" ><td colspan='2'>Play&nbsp;envelope:</td><td align='right'><input type='checkbox' id='envelope'></td></tr>
				<tr onmouseover="show_tooltip('en', 'voicemail', 13);" ><td colspan='2'>Max&nbsp;greeting&nbsp;(seconds)</td><td align='right' colspan='2'><input size=4 id='maxgreet' pattern='^\d*$'></td></tr>
				</table>
				</div>
			</td></tr>
			<tr onmouseover="show_tooltip('en', 'voicemail', 8);" ><td>
				<img onClick="togglefeatures()" src="images/adv-v.png">
			</td>
			</tr>
		</table>
		</div>
		</td>

	</tr><tr>
		<td align='center'>
		</td>
		<td align='center' colspan='2'>
				<input style='width:80' type='button' id='save' value='Save'>
				&nbsp;
				<input style='width:80' type='button' id='cancel' value='Cancel'>
				&nbsp;
		<div style='visibility:hidden;overflow:hidden;width:0px;height:0px'>
			<select id='hiddenusers'>
			</select>
			<select id='hiddenvoicemail'>
			</select>
		</div>
		</td>				
	</tr>
</table>
</div>
<div id='tooltip' style="margin-left:5px;height: 60px; width:575px; overflow :auto; font-family : Trebuchet MS, Arial, Helvetica, sans-serif;font-size: 11px; "></div>
</body>

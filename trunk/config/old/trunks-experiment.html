<!--
 * Asterisk -- An open source telephony toolkit.
 *
 * Configuration for Trunks generally
 *
 * Copyright (C) 1999 - 2006, Digium, Inc.
 *
 * Mark Spencer <markster@digium.com>
 *
 * See http://www.asterisk.org for more information about
 * the Asterisk project. Please do not directly contact
 * any of the maintainers of this project for assistance;
 * the project provides a web site, mailing lists and IRC
 * channels for your use.
 *
 * This program is free software, distributed under the terms of
 * the GNU General Public License Version 2. See the LICENSE file
 * at the top of the source tree.
 *
-->

<script src="scripts/prototype.js"></script>
<script src="scripts/rico.js"></script>
<script src="scripts/astman.js"></script>
<link href="stylesheets/rico.css" media="all" rel="Stylesheet" type="text/css" />
<link href="stylesheets/schwing.css" media="all" rel="Stylesheet" type="text/css" />

<script>
	var origwidth;
	var widgets = new Array;
	var provwidgets = new Array;
	var callbacks = new Object;
	var phonecallbacks = new Object;
	var providercallbacks = new Object;
	var fieldnames = new Array(
				'delete', 'status', 'new', 'save', 'cancel','secret', 'provider', 'zapchan'
				);
				
	var provfieldnames = new Array('providerdesc');

	providercallbacks.format = function(t) {
		return t.fieldbyname['providername'];
	}
	
	providercallbacks.loaded = function() {
		var newdiv;
		var cat;
		for (x=0;x<$('provider').length;x++) {
			cat = $('provider').stored_config.catbyname[$('provider').options[x].value];
			newdiv = document.createElement("div");
			newdiv.style.width = 300;
			newdiv.style.height = 75;
			newdiv.style.backgroundColor = "#ffffff";
			newdiv.style.borderColor="#000000";
			newdiv.style.borderStyle = "solid";
			newdiv.style.borderWidth = 1;
			if (x)
				newdiv.style.borderTopWidth = 0;
			newdiv.selector = $('providerlist')
			newdiv.onclick = function() {
				if (this.selector.lastselect) {
					this.selector.lastselect.style.color="#000000";
					this.selector.lastselect.style.backgroundColor="#ffffff";
				}
				this.style.backgroundColor = "#4444ff";
				this.style.color = "#ffffff";
				this.selector.lastselect = this;
				this.scrollIntoView();
			}
			newdiv.innerHTML = 
				"<img src='images/" + cat.name + ".gif'>" + cat.fieldbyname.providername + "";
			$('providerlist').insertBefore(newdiv, null);
		}
		parent.loadscreen(this);
	}
	
	callbacks.format = function(t) {
		if ((t.name == 'general'))
			return null;
		return t.fieldbyname['trunkname'];
	}

	callbacks.loaded = function() {
		$('devices').contentEditable = 'true';
		$('devices').disabled = 0;
		parent.astmanEngine.config2list("providers.conf", $('provider'), provwidgets, providercallbacks);
	}

	callbacks.sortfunc = function(a,b) {
		return (a.name < b.name) ? -1 : 1;
	}
	callbacks.checkparams = function(box) {
		$('mailbox').value = $('name').value;
		return false;
	}
	callbacks.newcategory = function() {
		var tmp = null;
		var x;
		if ($('devices').stored_config.catbyname['general'])
			tmp = objcopy($('devices').stored_config.catbyname['general']);
		if (tmp) {
			x = tmp.fieldbyname['userbase'];
			if (x) {
				tmp.name = first_free_exten($('devices'), x);
			}
		}
		return tmp;
	}
	callbacks.identifier = "extension";
	
	phonecallbacks.format = function(t) {
		if (t.fieldbyname['port'] == 'fxs')
			return "Analog Port #" + t.name;
		return null;
	}

	phonecallbacks.loaded = function() {
		var noneopt = document.createElement("OPTION");
		noneopt.value = "";
		noneopt.innerHTML = "None";
		$('zapchan').options.add(noneopt, 0);
		parent.astmanEngine.config2list("trunks.conf", $('devices'), widgets, callbacks);
	}
	
	function selectprovider() {
		var selected = $('provider').stored_config.catbyname[$('provider').value];
		alert("got here");
		if (selected) {
			alert("selected " + selected);
		}
	}
	
	function localajaxinit() {
		$('devices').contentEditable = 'false';
		for (var x in fieldnames) {
			widgets[fieldnames[x]] = $(fieldnames[x]);
			widgets[fieldnames[x]].disabled = true;
		}
		for (var x in provfieldnames) {
			provwidgets[provfieldnames[x]] = $(provfieldnames[x]);
			provwidgets[provfieldnames[x]].disabled = true;
		}
		parent.astmanEngine.config2list("zapscan.conf", $('zapchan'), new Array(), phonecallbacks);
	}
</script>


<body id="foo" onload="localajaxinit()">

<div class="mainscreenTitleBar">
	<span style="margin-left: 4px;font-weight:bold">User and Phone Configuration</span>
</div>
<div class="mainscreenContentBox" id="userscontent">
<table class="mainscreenTable" align="center">
	<tr valign="top">
		<td colspan='2'>
		Users:
		</td>
	</tr>
	<tr valign="top">
		<td>
		<select disabled size="28" id="devices" style="width:220px">
		<option>Loading...</option>
		</select>
		</td>
		<td colspan='3'>
		<div id='adjustments' style='width:350'>
		<table cellspacing='0' cellpadding='0'>
			<tr valign="top"><td>
				<table>
				<tr><td>Analog Lines:</td><td><select size="1" id='zapchan' style='width:200px'></select></td></tr>
				<tr><td colspan='2'><hr></td></tr>
				<tr><td>Username:</td><td><input size='20' id='username'></td></tr>
				<tr><td>Password:</td><td><input size='5' id='secret'></td></tr>
				<tr><td>Provider:</td><td><select size='4' id='provider' style='width:200px' altonchange='selectprovider()'></select></td></tr>
				<tr><td colspan='2' align='center'><div style="height:15px" id='status'></div></td></tr>
				<tr><td colspan='2' align='center'><div id='providerdesc' style='width:300px;height:100px'></div></td></tr>
				<tr><td colspan='2' align='left'><div id='providerlist' style='overflow-y:scroll;height:150px'></div></td></tr>
				</table>
			</td>
			</tr>
			</tr>
		</table>
		</div>
		</td></tr>				
		<tr>
		<td align='center'>
			<table>
			<tr align='center'><td>
			<input style='width:80' type='button' id='new' value='New'>
			</td><td>
			<input style='width:80' type='button' id='delete' value='Delete'>
			</td></tr>
			</table>
		</td>
		<td colspan='1' align='right'>
				<input style='width:80' type='button' id='save' value='Save'>
				&nbsp;
				<input style='width:80' type='button' id='cancel' value='Cancel'>
				&nbsp;
		</td>
	</tr><tr>
	</tr>
</table>
</div>
</body>
